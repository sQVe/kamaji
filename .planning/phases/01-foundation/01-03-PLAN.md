---
phase: 01-foundation
plan: 03
type: execute
depends_on: ["01-01"]
files_modified:
    - cmd/kamaji/script_test.go
    - cmd/kamaji/testdata/script/version.txt
    - cmd/kamaji/testdata/script/help.txt
---

<objective>
Testscript infrastructure for integration testing.

Purpose: Enable end-to-end testing of CLI behavior using script-based tests.
Output: Working testscript setup with version and help tests.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@DESIGN.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

**Reference patterns from stash:**

- `git show stash@{0}:cmd/kamaji/script_test.go` - TestScript setup with TestMain
- `git show stash@{0}:cmd/kamaji/testdata/script/version.txt` - Example test script

**go-internal/testscript:**

- Scripts in testdata/script/\*.txt
- Build tag: `//go:build integration`
- TestMain registers "kamaji" command
- Run with: `go test -tags=integration ./cmd/kamaji/...`

**Makefile target:**

```
test-integration:
	@gotestsum -- -tags=integration -timeout=300s ./cmd/kamaji/...
```

</context>

<tasks>

<task type="auto">
  <name>Task 1: Create testscript infrastructure</name>
  <files>cmd/kamaji/script_test.go</files>
  <action>
Create script_test.go with:
- Build tag: `//go:build integration`
- TestScript function that runs testscript.Run with Dir: "testdata/script"
- TestMain that registers "kamaji": main via testscript.Main

This enables running kamaji commands in script tests without building a binary.

Reference: `git show stash@{0}:cmd/kamaji/script_test.go`
</action>
<verify>go build -tags=integration ./cmd/kamaji/...</verify>
<done>File compiles with integration tag</done>
</task>

<task type="auto">
  <name>Task 2: Create initial test scripts</name>
  <files>cmd/kamaji/testdata/script/version.txt, cmd/kamaji/testdata/script/help.txt</files>
  <action>
Create test scripts:

version.txt - Test version flag:

```
# kamaji version
exec kamaji --version
stdout 'dev'
! stderr .
```

help.txt - Test help flag:

```
# kamaji help
exec kamaji --help
stdout 'Kamaji'
stdout 'orchestrates autonomous coding sprints'
! stderr .
```

Testscript syntax:

- `exec` runs command
- `stdout` asserts stdout contains pattern
- `! stderr .` asserts stderr is empty
- Lines starting with # are comments
  </action>
  <verify>make test-integration</verify>
  <done>Both test scripts pass, integration tests run successfully</done>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build -tags=integration ./cmd/kamaji/...` compiles
- [ ] `make test-integration` passes both scripts
- [ ] Unit tests still pass: `make test`
- [ ] `make lint` passes
</verification>

<success_criteria>

- All tasks completed
- Integration test infrastructure works
- version.txt and help.txt pass
- Separated from unit tests via build tag
- No linter errors
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`

**Phase 1 complete when this plan finishes.**
</output>
