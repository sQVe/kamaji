---
phase: 07-ticket-logging
plan: 01
type: execute
depends_on: []
files_modified: [internal/config/history.go, internal/config/history_test.go]
---

<objective>
Add convenience functions for recording completed tasks, failed attempts, and insights to ticket history files.

Purpose: Enable the orchestrator to persist task outcomes without manually managing load/append/save cycles.
Output: Three recording functions in config package with tests.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Existing infrastructure (from Phase 1):**
@internal/domain/history.go
@internal/config/history.go
@internal/config/history_test.go

**Key patterns:**

- LoadTicketHistory returns empty history with ticket name if file doesn't exist
- SaveTicketHistory creates .kamaji/history/ directory if needed
- sanitizeFilename handles cross-platform filename safety
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add RecordCompleted and RecordFailed functions</name>
  <files>internal/config/history.go, internal/config/history_test.go</files>
  <action>
Add two functions to internal/config/history.go:

```go
// RecordCompleted loads the ticket history, appends a completed task, and saves.
func RecordCompleted(dir, ticketName, taskDesc, summary string) error

// RecordFailed loads the ticket history, appends a failed attempt, and saves.
func RecordFailed(dir, ticketName, taskDesc, summary string) error
```

Each function should:

1. Call LoadTicketHistory to get current history (handles missing file)
2. Append to the appropriate slice (Completed or FailedAttempts)
3. Call SaveTicketHistory to persist

Add tests covering:

- Recording to empty history (new file created)
- Recording to existing history (appends, doesn't overwrite)
- Error propagation from SaveTicketHistory
  </action>
  <verify>go test -v ./internal/config/... -run "Record(Completed|Failed)" passes</verify>
  <done>RecordCompleted and RecordFailed functions exist with tests passing</done>
  </task>

<task type="auto">
  <name>Task 2: Add RecordInsight function</name>
  <files>internal/config/history.go, internal/config/history_test.go</files>
  <action>
Add function to internal/config/history.go:

```go
// RecordInsight loads the ticket history, appends an insight, and saves.
func RecordInsight(dir, ticketName, text string) error
```

Same pattern as Task 1:

1. LoadTicketHistory
2. Append to Insights slice
3. SaveTicketHistory

Add tests covering:

- Recording to empty history
- Recording multiple insights (accumulates)
- Duplicate insight handling (just append, no dedup needed per DESIGN.md)
  </action>
  <verify>go test -v ./internal/config/... -run "RecordInsight" passes</verify>
  <done>RecordInsight function exists with tests passing, all three recording functions verified</done>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go test ./internal/config/...` passes all tests
- [ ] `make lint` passes
- [ ] RecordCompleted, RecordFailed, RecordInsight all exist and work
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Three recording functions work correctly
- Tests cover empty history, existing history, and error cases
  </success_criteria>

<output>
After completion, create `.planning/phases/07-ticket-logging/07-01-SUMMARY.md`
</output>
