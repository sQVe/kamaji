---
phase: 12-init
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
    - cmd/kamaji/init.go
    - cmd/kamaji/main.go
autonomous: true

must_haves:
    truths:
        - "User can run kamaji init and get kamaji.yaml created in CWD"
        - "Generated file contains valid YAML with inline comments"
        - "Running kamaji init when kamaji.yaml exists shows error without overwriting"
    artifacts:
        - path: "cmd/kamaji/init.go"
          provides: "Init command implementation"
          exports: ["initCmd"]
        - path: "cmd/kamaji/main.go"
          provides: "Root command with init wired in"
          contains: "cmd.AddCommand(initCmd())"
    key_links:
        - from: "cmd/kamaji/init.go"
          to: "internal/output"
          via: "PrintSuccess/PrintError calls"
          pattern: "output\\.Print(Success|Error)"
        - from: "cmd/kamaji/main.go"
          to: "cmd/kamaji/init.go"
          via: "AddCommand registration"
          pattern: "AddCommand\\(initCmd\\(\\)\\)"
---

<objective>
Create the `kamaji init` command that generates a template kamaji.yaml configuration file with explanatory comments.

Purpose: Users need a quick way to bootstrap a new sprint configuration without manually writing YAML from scratch.
Output: Working `kamaji init` command that creates kamaji.yaml with inline documentation.
</objective>

<execution_context>
@/home/sqve/.claude/get-shit-done/workflows/execute-plan.md
@/home/sqve/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-init/12-RESEARCH.md
@cmd/kamaji/validate.go
@cmd/kamaji/main.go
@internal/output/styles.go
@internal/domain/sprint.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create init command with YAML template</name>
  <files>cmd/kamaji/init.go</files>
  <action>
Create `cmd/kamaji/init.go` following the exact pattern from `cmd/kamaji/validate.go`:

1. Define the YAML template as a raw string constant with backticks. Include inline comments explaining each section:
    - `name` - Sprint name (required)
    - `base_branch` - Branch to create ticket branches from
    - `rules` - Guidelines for the AI agent
    - `tickets` - Array with one example ticket containing:
        - `name` - Ticket identifier (required)
        - `branch` - Git branch name
        - `description` - What the ticket accomplishes
        - `tasks` - Array with one example task containing:
            - `description` - What the task does (required)
            - `steps` - Optional step-by-step guidance
            - `verify` - How to verify completion

2. Create `initCmd()` function returning `*cobra.Command`:
    - Use: "init"
    - Short: "Create a new kamaji.yaml configuration file"
    - RunE handler that:
      a. Gets working directory with `os.Getwd()`
      b. Builds config path: `filepath.Join(workDir, "kamaji.yaml")`
      c. Checks file existence with `os.Stat()`:
        - If file exists: `output.PrintError("kamaji.yaml already exists")`, return `errConfigInvalid`
        - If other error (not os.ErrNotExist): return wrapped error
          d. Writes template with `os.WriteFile(configPath, []byte(template), 0644)`
          e. On write error: `output.PrintError()` and return `errConfigInvalid`
          f. On success: `output.PrintSuccess("Created kamaji.yaml")`
    - Set `cmd.SilenceUsage = true`

Use `errors.Is(err, os.ErrNotExist)` for modern Go error checking (not `os.IsNotExist`).

The template must be valid YAML that passes `config.LoadSprint()` and `config.ValidateSprint()`.
</action>
<verify>
Run `go build ./cmd/kamaji` to verify compilation.
Run `go vet ./cmd/kamaji` to verify no issues.
</verify>
<done>
init.go exists with initCmd function, compiles without errors.
</done>
</task>

<task type="auto">
  <name>Task 2: Wire init command into CLI</name>
  <files>cmd/kamaji/main.go</files>
  <action>
In `cmd/kamaji/main.go`, add the init command to rootCmd:

1. In the `rootCmd()` function, add: `cmd.AddCommand(initCmd())`
    - Place it after validateCmd() to maintain alphabetical order of commands
    - Or before validateCmd() if init should come first logically (init before validate)

No other changes needed - errConfigInvalid sentinel is already defined in validate.go.
</action>
<verify>
Run `go build ./cmd/kamaji && ./kamaji --help` to verify init command appears.
Run `make lint` to verify no linting issues.
</verify>
<done>
`kamaji --help` shows init command in list.
</done>
</task>

<task type="auto">
  <name>Task 3: Verify init command behavior</name>
  <files></files>
  <action>
Test the init command manually to verify all requirements:

1. Create temp directory and test init:

    ```bash
    cd $(mktemp -d)
    /path/to/kamaji init
    ```

    Expected: "Created kamaji.yaml" message, file exists

2. Test duplicate detection:

    ```bash
    kamaji init  # run again in same dir
    ```

    Expected: "kamaji.yaml already exists" error, exit 1

3. Verify generated YAML is valid:

    ```bash
    kamaji validate  # should pass validation
    ```

    Expected: "Configuration is valid" message

4. Verify YAML has comments:
    ```bash
    head -20 kamaji.yaml  # should show comment lines starting with #
    ```

If any test fails, fix the issue in init.go.
</action>
<verify>
All four manual tests pass.
</verify>
<done>

- `kamaji init` creates kamaji.yaml with success message
- `kamaji init` on existing file shows error without overwriting
- Generated kamaji.yaml passes `kamaji validate`
- Generated file contains explanatory comments
  </done>
  </task>

</tasks>

<verification>
Requirements coverage:
- INIT-01: `kamaji init` creates template config - covered by Tasks 1-3
- INIT-02: Template contains comments explaining sections - covered by Task 1 template design
- INIT-03: Init fails gracefully if file exists - covered by Task 1 existence check, Task 3 verification
</verification>

<success_criteria>

1. `kamaji init` in empty directory creates kamaji.yaml and prints success
2. `kamaji init` when kamaji.yaml exists prints error and exits 1 without modifying file
3. Generated kamaji.yaml passes `kamaji validate`
4. Generated kamaji.yaml contains inline comments explaining each field
5. `make ci` passes (build, lint, test)
   </success_criteria>

<output>
After completion, create `.planning/phases/12-init/12-01-SUMMARY.md`
</output>
