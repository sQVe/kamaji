---
phase: 08-streaming-output
plan: 02
wave: 2
type: execute
depends_on: ["08-01"]
files_modified:
    [
        internal/output/progress.go,
        internal/output/progress_test.go,
        internal/output/signal.go,
        internal/output/signal_test.go,
    ]
autonomous: true
---

<objective>
Create progress indicators and status display for sprint execution.

Purpose: Show task progress, MCP signal feedback, and git operation status during sprint runs.
Output: Progress display functions ready for orchestrator integration.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-streaming-output/08-01-SUMMARY.md

**Existing infrastructure:**
@internal/statemachine/statemachine.go - TaskInfo struct with indices
@internal/mcp/tools.go - Signal struct (Tool, Status, Summary)
@internal/domain/sprint.go - Sprint, Ticket, Task types
@internal/output/styles.go - Style, Prefix, MessageType (from 08-01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Task progress display</name>
  <files>internal/output/progress.go, internal/output/progress_test.go</files>
  <action>
Create progress display for task execution:

```go
// internal/output/progress.go
package output

import "github.com/sqve/kamaji/internal/statemachine"
import "github.com/sqve/kamaji/internal/domain"

// TaskProgress formats task progress indicator.
// Format: "Ticket 1/3 > Task 2/5: Create login form"
func TaskProgress(info *statemachine.TaskInfo, sprint *domain.Sprint) string

// PrintTaskStart outputs task progress when starting a task.
func PrintTaskStart(info *statemachine.TaskInfo, sprint *domain.Sprint)

// PrintTicketStart outputs when starting a new ticket.
// Format: "Starting ticket: login-form (feat/login-form)"
func PrintTicketStart(ticket *domain.Ticket)
```

Styled output uses:

- Ticket number: bold
- Task number: bold
- Description: normal
- Branch name: dim

Plain output uses brackets: "[Ticket 1/3] [Task 2/5] Create login form"

Tests should verify:

- Correct formatting for various positions
- Styled vs plain output
- Edge cases (single ticket, single task)
  </action>
  <verify>go test -v ./internal/output/... -run TaskProgress passes</verify>
  <done>TaskProgress and PrintTaskStart display correct progress indicators</done>
  </task>

<task type="auto">
  <name>Task 2: MCP signal formatting</name>
  <files>internal/output/signal.go, internal/output/signal_test.go</files>
  <action>
Create signal display for MCP tool calls:

```go
// internal/output/signal.go
package output

import "github.com/sqve/kamaji/internal/mcp"

// FormatSignal returns a styled string for an MCP signal.
func FormatSignal(sig mcp.Signal) string

// PrintSignal outputs an MCP signal with appropriate styling.
func PrintSignal(sig mcp.Signal)
```

task_complete(pass) format:

- Styled: green checkmark + "Task completed: " + summary
- Plain: "[ok] Task completed: " + summary

task_complete(fail) format:

- Styled: red X + "Task failed: " + summary
- Plain: "Error: Task failed: " + summary

note_insight format:

- Styled: blue info icon + "Insight: " + text
- Plain: "-> Insight: " + text

Tests should verify all signal types in both modes.
</action>
<verify>go test -v ./internal/output/... -run Signal passes</verify>
<done>FormatSignal and PrintSignal handle all signal types correctly</done>
</task>

<task type="auto">
  <name>Task 3: Git operation feedback</name>
  <files>internal/output/progress.go, internal/output/progress_test.go</files>
  <action>
Add git operation status messages:

```go
// PrintBranchCreated outputs branch creation success.
// Format: "Created branch: feat/login-form"
func PrintBranchCreated(branch string)

// PrintCommitCreated outputs commit success.
// Format: "Committed: <summary truncated to 50 chars>"
func PrintCommitCreated(message string)

// PrintResetPerformed outputs reset notification.
// Format: "Reset to HEAD (discarding changes)"
func PrintResetPerformed()
```

All use Info style (blue arrow / "->").

Tests should verify output format and truncation behavior.
</action>
<verify>go test -v ./internal/output/... -run Git passes</verify>
<done>Git operation feedback functions exist with correct formatting</done>
</task>

<task type="auto">
  <name>Task 4: Sprint status overview</name>
  <files>internal/output/progress.go, internal/output/progress_test.go</files>
  <action>
Add sprint status summary:

```go
// SprintStatus returns a formatted sprint status string.
func SprintStatus(sprint *domain.Sprint, state *domain.State) string

// PrintSprintStatus outputs the current sprint status.
func PrintSprintStatus(sprint *domain.Sprint, state *domain.State)

// PrintSprintComplete outputs sprint completion message.
func PrintSprintComplete(sprint *domain.Sprint)

// PrintSprintStuck outputs stuck state message.
// Includes failure count and current task.
func PrintSprintStuck(sprint *domain.Sprint, state *domain.State)
```

Status format:

```
Sprint: "Feature Sprint"
Progress: 2/4 tickets, 5/12 tasks
Current: Ticket 3 (auth-flow) > Task 2/3
```

Tests should verify status calculation and formatting.
</action>
<verify>go test -v ./internal/output/... passes all tests</verify>
<done>Sprint status functions show accurate progress and state</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go test ./internal/output/...` passes all tests
- [ ] `make test` passes all tests
- [ ] `make lint` passes with 0 issues
- [ ] Progress indicators show correct ticket/task counts
- [ ] MCP signals display with appropriate styling
- [ ] Git feedback messages are clear and informative
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Task progress shows "Ticket N/M > Task X/Y" format
- MCP signals formatted with pass/fail distinction
- Git operations have feedback messages
- Sprint status provides overview of progress
- Both styled and plain modes work correctly
  </success_criteria>

<must_haves>

- TaskProgress shows "Ticket N/M > Task X/Y: description" format
- PrintSignal distinguishes pass (green/[ok]) from fail (red/Error:)
- PrintSignal handles note_insight with info style
- Git feedback uses info style for all operations
- SprintStatus calculates correct progress from state
  </must_haves>
